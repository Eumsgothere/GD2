using UnityEngine;

public class TargetWall : MonoBehaviour
{
    [SerializeField] private Renderer wallRenderer;
    [SerializeField] private Color blueColor = Color.blue;
    [SerializeField] private Color redColor = Color.red;
    [SerializeField] private GameObject slidingWall; // assign in Inspector

    private Color currentColor;
    private int correctHits = 0;
    private float timer = 0f;
    private float changeInterval = 1f; // every second

    private void Start()
    {
        if (wallRenderer == null)
            wallRenderer = GetComponent<Renderer>();

        ChangeColor();
    }

    private void Update()
    {
        timer += Time.deltaTime;
        if (timer >= changeInterval)
        {
            timer = 0f;
            ChangeColor();
        }
    }

    private void ChangeColor()
    {
        currentColor = (Random.value > 0.5f) ? blueColor : redColor;
        wallRenderer.material.color = currentColor;
    }

    public void RegisterHit(string ballTag)
    {
        // Match check
        if ((currentColor == blueColor && ballTag == "BlueBall") ||
            (currentColor == redColor && ballTag == "RedBall"))
        {
            correctHits++;
            Debug.Log("Correct hit! Count = " + correctHits);

            if (correctHits >= 3)
            {
                OpenSlidingWall();
            }
        }
        else
        {
            Debug.Log("Wrong color hit!");
        }
    }

    private void OpenSlidingWall()
    {
        Debug.Log("Sliding wall opened!");

        if (slidingWall != null)
        {
            slidingWall.transform.position += Vector3.up * 5f;
        }
    }
}
