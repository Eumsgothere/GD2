using UnityEngine;

public class SphereRed : MonoBehaviour
{
    [SerializeField] private Renderer sphereRenderer;
    [SerializeField] private Color redColor = Color.red;
    [SerializeField] private Color blueColor = Color.blue;

    private Color currentColor;

    // Static counts shared across all SphereRed objects
    private static int totalTargets;
    private static int destroyedTargets;

    private void Start()
    {
        if (sphereRenderer == null)
            sphereRenderer = GetComponent<Renderer>();

        // Randomly choose red or blue
        currentColor = (Random.value > 0.5f) ? blueColor : redColor;
        sphereRenderer.material.color = currentColor;

        // Count all targets in scene
        totalTargets = FindObjectsOfType<SphereRed>().Length;
    }

    private void OnCollisionEnter(Collision collision)
    {
        // Only respond to red or blue balls
        if (!collision.gameObject.CompareTag("RedBall") && !collision.gameObject.CompareTag("BlueBall"))
            return;

        bool isRedTarget = currentColor == redColor;
        string ballTag = collision.gameObject.tag;

        // Destroy only if color matches
        if ((isRedTarget && ballTag == "RedBall") || (!isRedTarget && ballTag == "BlueBall"))
        {
            destroyedTargets++;
            Destroy(gameObject);
            Debug.Log($"Target destroyed! {destroyedTargets}/{totalTargets}");

            // Check if all targets are destroyed
            if (destroyedTargets >= totalTargets)
            {
                Debug.Log("All targets destroyed! Opening door...");
                RotatingDoor.OpenDoor();
            }
        }
        else
        {
            Debug.Log("Wrong color hit!");
        }
    }
}